# OPERATING_PLAN.md

## 目标（2026-02-07 Hackathon）

在 15:30 SGT 提交前，完成一个可演示的 AI Backend MVP：
`逾期发票 -> 风险推理 -> 催收策略 -> 执行与审计`

约束：
- 今晚（2026-02-06）只做计划与设计，不写业务代码。
- 明天实现优先级：先跑通主链路，再扩展。
- 明天执行采用：`Codex 主开发` + `Claude Code 主审查`。

## 角色分工

### Codex（负责人：主开发实现）

负责：
- 问题定义与范围冻结（MVP / 不做清单）
- 架构设计（Reasoner / Skill / Memory / Discovery）
- Agent 输入输出契约（数据结构、字段、错误语义）
- 任务拆解与执行顺序
- 风险预案（模型失败、网络失败、演示失败）
- 编码实现与联调修复（主链路优先）
- Demo 叙事与评审映射
- 按 Claude 审查结果进行最小修复

不负责：
- 不绕过审查直接合并高风险改动

### Claude（负责人：审查与质量闸门）

负责：
- 审查 Codex 改动并给出 PASS/FAIL
- 检查正确性、回归风险、边界条件、测试缺口
- 返回最小修复任务卡（按严重级别排序）
- 对最终提交前版本做一次完整质量复核

不负责：
- 在未明确授权时大范围重构

## 协作闭环（固定流程）

1. `Codex` 实现一个最小任务（20~40 分钟可完成）。
2. `Claude` 对该改动做审查并输出 PASS/FAIL。
3. 若 FAIL，`Codex` 按最小修复卡补丁。
4. 仅在 `Claude PASS` 后进入下一任务。

## 应急切换流程（Codex阻塞 -> Claude短时接管）

触发条件（满足任一即切换）：
- Codex 连续 2 轮无法完成关键任务，影响主链路。
- Codex 侧工具/环境不可用且预计 >30 分钟不可恢复。

切换步骤（10 分钟内完成）：
1. `Codex` 停止新开发，只做状态冻结。
2. `Codex` 输出最后一次交接（见下文“交接格式”），补齐：已完成、进行中、阻塞、下一步。
3. `Claude` 短时接管实现，按 `P0 > 稳定性 > Demo` 顺序继续。
4. 所有非关键增强项自动降级为 `P1` 或直接删除。

接管后的优先级：
1. 先确保 `P0-3` 主链路全通并可复现。
2. 再补 `P0-4` 样例与可读日志。
3. 最后做必要修复，停止新增功能。

## Task Card 模板（Codex 每轮都给）

- 任务名：
- 背景与目标（1-2 句）：
- 输入：
- 输出：
- 边界条件：
- 失败处理：
- 验收标准（DoD）：
- 交付文件路径：
- 预计耗时：

## 实现任务拆解（明天执行）

### P0：必须完成

1. 定义模型与契约
- Invoice / Customer / Decision / AuditEvent
- 统一字段：`risk_level`, `confidence`, `reasons`, `next_action`

2. 实现 3 个 Agent
- `invoice_risk_reasoner`
- `collection_strategy_reasoner`
- `execute_and_audit_skill`

3. 串联主流程
- 单输入 -> 全链路输出
- 输出可读日志与审计记录

4. 准备样例数据
- 低/中/高风险至少各 2 条

### P1：有时间再做

1. 增加 fallback 规则（Reasoner 失败自动降级）
2. 增加简单评估脚本（统计风险分布/执行耗时）
3. 增加更清晰的 demo 展示层（CLI 表格或简版 UI）

## 时间线（SGT）

### 今晚 2026-02-06（计划夜）

1. 冻结 MVP 范围与不做清单
2. 完成 Agent 契约文档
3. 完成 Demo 脚本（3 分钟）
4. 完成风险预案与分工

### 明天 2026-02-07（比赛日）

1. 10:30-11:30：P0-1 + P0-2
2. 11:30-12:30：P0-3（跑通主流程）
3. 13:00-14:00：P0-4 + 日志可视化
4. 14:00-14:45：稳定性修复 + fallback
5. 14:45-15:15：Demo 彩排（至少 2 次）
6. 15:15-15:30：打包提交

## 变更与决策规则

- 任何新增需求必须回答：
  - 是否影响 15:30 提交？
  - 是否会破坏主链路稳定性？
- 若答案不明确，默认不做。
- 明天 12:30 前禁止新增第 4 个 Agent。

## 质量门槛（DoD）

每个功能通过以下检查才算完成：

1. 输入输出结构与契约一致。
2. 错误可被处理，不会中断整个流程。
3. 有可读日志，能解释决策原因。
4. 能在本地稳定复现（至少连续跑 3 次）。

## Demo 讲述框架（固定）

1. 痛点：传统规则 + 人工流程维护困难。
2. 方案：AI Backend（Reasoner 决策，Skill 执行，Memory 共享）。
3. 现场：展示 1 条输入如何自动完成决策与执行。
4. 价值：更快、更可解释、更易扩展。

## 风险预案

1. 模型超时：降级到默认策略并标注 `fallback=true`。
2. 网络问题：使用本地样例和预生成输出演示。
3. 结果不稳定：固定 prompt + 固定样例 + 限制温度。
4. 时间不够：只保留主链路，不做增强功能。

## 交接格式（Codex 每次回报）

- 已完成：
- 产出文件：
- 运行结果：
- 未解决问题：
- 下一步建议：
- 当前分支/最新提交：
- 正在进行中的任务（可直接续做）：
- 阻塞项与绕过方案：

## 最终提交检查（15:20 前）

1. 主链路可跑。
2. Demo 3 分钟可讲完。
3. 评审四项有对应证据。
4. 代码和说明可被他人快速复现。
